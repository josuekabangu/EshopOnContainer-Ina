apiVersion: v1
kind: Pod
metadata:
  name: test-rabbitmq-connection
  namespace: {{ .Values.namespace | default "dev" }}
  labels:
    app.kubernetes.io/name: rabbitmq
    helm.sh/hook: test
spec:
  containers:
  - name: rabbitmq-test
    image: busybox:1.36
    command:
    - sh
    - -c
    - |
      echo "Testing RabbitMQ connection...";
      until nc -z rabbitmq-0.rabbitmq-headless.dev.svc.cluster.local 5672; do
        echo "Waiting for RabbitMQ to be ready...";
        sleep 2;
      done;
      echo "RabbitMQ is ready!";
      # Vous pouvez ajouter ici d'autres commandes de test, comme par exemple publier un message ou v√©rifier la file RabbitMQ.
  restartPolicy: Never
