apiVersion: v1
kind: Pod
metadata:
  name: redis-test-connection
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: redis-cli
      image: redis:7.2-alpine
      env:
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: redis-secret
              key: REDIS_PASSWORD
      command: ["redis-cli", "-h", "redis", "-a", "$(REDIS_PASSWORD)", "ping"]
  restartPolicy: Never
